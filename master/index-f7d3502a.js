import e from"node:http";import t from"node:https";import r from"node:zlib";import n,{PassThrough as o,pipeline as s}from"node:stream";import{Buffer as i}from"node:buffer";import{types as a,promisify as c,deprecate as l}from"node:util";import{format as u}from"node:url";import{isIP as f}from"node:net";import{statSync as d,createReadStream as h,promises as p}from"node:fs";import{basename as y}from"node:path";import g from"worker_threads";if(!globalThis.ReadableStream)try{const e=require("node:process"),{emitWarning:t}=e;try{e.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),e.emitWarning=t}catch(r){throw e.emitWarning=t,r}}catch(e){Object.assign(globalThis,require("web-streams-polyfill/dist/ponyfill.es2018.js"))}try{const{Blob:e}=require("buffer");e&&!e.prototype.stream&&(e.prototype.stream=function(e){let t=0;const r=this;return new ReadableStream({type:"bytes",async pull(e){const n=r.slice(t,Math.min(r.size,t+65536)),o=await n.arrayBuffer();t+=o.byteLength,e.enqueue(new Uint8Array(o)),t===r.size&&e.close()}})})}catch(e){}
/*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */async function*m(e,t=!0){for(const r of e)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(t){let e=r.byteOffset;const t=r.byteOffset+r.byteLength;for(;e!==t;){const n=Math.min(t-e,65536),o=r.buffer.slice(e,e+n);e+=o.byteLength,yield new Uint8Array(o)}}else yield r;else{let e=0,t=r;for(;e!==t.size;){const r=t.slice(e,Math.min(t.size,e+65536)),n=await r.arrayBuffer();e+=n.byteLength,yield new Uint8Array(n)}}}const b=class e{#e=[];#t="";#r=0;#n="transparent";constructor(t=[],r={}){if("object"!=typeof t||null===t)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if("function"!=typeof t[Symbol.iterator])throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof r&&"function"!=typeof r)throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");null===r&&(r={});const n=new TextEncoder;for(const r of t){let t;t=ArrayBuffer.isView(r)?new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):r instanceof ArrayBuffer?new Uint8Array(r.slice(0)):r instanceof e?r:n.encode(`${r}`),this.#r+=ArrayBuffer.isView(t)?t.byteLength:t.size,this.#e.push(t)}this.#n=`${void 0===r.endings?"transparent":r.endings}`;const o=void 0===r.type?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#r}get type(){return this.#t}async text(){const e=new TextDecoder;let t="";for await(const r of m(this.#e,!1))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){const e=new Uint8Array(this.size);let t=0;for await(const r of m(this.#e,!1))e.set(r,t),t+=r.length;return e.buffer}stream(){const e=m(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){const r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(t=0,r=this.size,n=""){const{size:o}=this;let s=t<0?Math.max(o+t,0):Math.min(t,o),i=r<0?Math.max(o+r,0):Math.min(r,o);const a=Math.max(i-s,0),c=this.#e,l=[];let u=0;for(const e of c){if(u>=a)break;const t=ArrayBuffer.isView(e)?e.byteLength:e.size;if(s&&t<=s)s-=t,i-=t;else{let r;ArrayBuffer.isView(e)?(r=e.subarray(s,Math.min(t,i)),u+=r.byteLength):(r=e.slice(s,Math.min(t,i)),u+=r.size),i-=t,l.push(r),s=0}}const f=new e([],{type:String(n).toLowerCase()});return f.#r=a,f.#e=l,f}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&"object"==typeof e&&"function"==typeof e.constructor&&("function"==typeof e.stream||"function"==typeof e.arrayBuffer)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(b.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});const w=b,T=class extends w{#o=0;#s="";constructor(e,t,r={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),null===r&&(r={});const n=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(n)||(this.#o=n),this.#s=String(t)}get name(){return this.#s}get lastModified(){return this.#o}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof w&&/^(File)$/.test(e[Symbol.toStringTag])}};
/*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */
var{toStringTag:S,iterator:v,hasInstance:E}=Symbol,R=Math.random,L="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),$=(e,t,r)=>(e+="",/^(Blob|File)$/.test(t&&t[S])?[(r=void 0!==r?r+"":"File"==t[S]?t.name:"blob",e),t.name!==r||"blob"==t[S]?new T([t],r,t):t]:[e,t+""]),x=(e,t)=>(t?e:e.replace(/\r?\n|\r/g,"\r\n")).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),M=(e,t,r)=>{if(t.length<r)throw new TypeError(`Failed to execute '${e}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)};const P=class{#i=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[S](){return"FormData"}[v](){return this.entries()}static[E](e){return e&&"object"==typeof e&&"FormData"===e[S]&&!L.some((t=>"function"!=typeof e[t]))}append(...e){M("append",arguments,2),this.#i.push($(...e))}delete(e){M("delete",arguments,1),e+="",this.#i=this.#i.filter((([t])=>t!==e))}get(e){M("get",arguments,1),e+="";for(var t=this.#i,r=t.length,n=0;n<r;n++)if(t[n][0]===e)return t[n][1];return null}getAll(e,t){return M("getAll",arguments,1),t=[],e+="",this.#i.forEach((r=>r[0]===e&&t.push(r[1]))),t}has(e){return M("has",arguments,1),e+="",this.#i.some((t=>t[0]===e))}forEach(e,t){for(var[r,n]of(M("forEach",arguments,1),this))e.call(t,n,r,this)}set(...e){M("set",arguments,2);var t=[],r=!0;e=$(...e),this.#i.forEach((n=>{n[0]===e[0]?r&&(r=!t.push(e)):t.push(n)})),r&&t.push(e),this.#i=t}*entries(){yield*this.#i}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}};class U extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class z extends U{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}const A=Symbol.toStringTag,B=e=>"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&"function"==typeof e.sort&&"URLSearchParams"===e[A],k=e=>e&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&/^(Blob|File)$/.test(e[A]),C=c(n.pipeline),j=Symbol("Body internals");class O{constructor(e,{size:t=0}={}){let r=null;null===e?e=null:B(e)?e=i.from(e.toString()):k(e)||i.isBuffer(e)||(a.isAnyArrayBuffer(e)?e=i.from(e):ArrayBuffer.isView(e)?e=i.from(e.buffer,e.byteOffset,e.byteLength):e instanceof n||(e instanceof P?r=(e=function(e,t=w){var r=`${R()}${R()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],o=`--${r}\r\nContent-Disposition: form-data; name="`;return e.forEach(((e,t)=>"string"==typeof e?n.push(o+x(t)+`"\r\n\r\n${e.replace(/\r(?!\n)|(?<!\r)\n/g,"\r\n")}\r\n`):n.push(o+x(t)+`"; filename="${x(e.name,1)}"\r\nContent-Type: ${e.type||"application/octet-stream"}\r\n\r\n`,e,"\r\n"))),n.push(`--${r}--`),new t(n,{type:"multipart/form-data; boundary="+r})}(e)).type.split("=")[1]:e=i.from(String(e))));let o=e;i.isBuffer(e)?o=n.Readable.from(e):k(e)&&(o=n.Readable.from(e.stream())),this[j]={body:e,stream:o,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof n&&e.on("error",(e=>{const t=e instanceof U?e:new z(`Invalid response body while trying to fetch ${this.url}: ${e.message}`,"system",e);this[j].error=t}))}get body(){return this[j].stream}get bodyUsed(){return this[j].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:t,byteLength:r}=await F(this);return e.slice(t,t+r)}async formData(){const e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){const e=new P,t=new URLSearchParams(await this.text());for(const[r,n]of t)e.append(r,n);return e}const{toFormData:t}=await import("./multipart-parser-d17e8fb0.js");return t(this.body,e)}async blob(){const e=this.headers&&this.headers.get("content-type")||this[j].body&&this[j].body.type||"",t=await this.arrayBuffer();return new w([t],{type:e})}async json(){const e=await this.text();return JSON.parse(e)}async text(){const e=await F(this);return(new TextDecoder).decode(e)}buffer(){return F(this)}}async function F(e){if(e[j].disturbed)throw new TypeError(`body used already for: ${e.url}`);if(e[j].disturbed=!0,e[j].error)throw e[j].error;const{body:t}=e;if(null===t)return i.alloc(0);if(!(t instanceof n))return i.alloc(0);const r=[];let o=0;try{for await(const n of t){if(e.size>0&&o+n.length>e.size){const r=new z(`content size at ${e.url} over limit: ${e.size}`,"max-size");throw t.destroy(r),r}o+=n.length,r.push(n)}}catch(t){throw t instanceof U?t:new z(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t)}if(!0!==t.readableEnded&&!0!==t._readableState.ended)throw new z(`Premature close of server response while trying to fetch ${e.url}`);try{return r.every((e=>"string"==typeof e))?i.from(r.join("")):i.concat(r,o)}catch(t){throw new z(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t)}}O.prototype.buffer=l(O.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer"),Object.defineProperties(O.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:l((()=>{}),"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});const q=(e,t)=>{let r,s,{body:i}=e[j];if(e.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof n&&"function"!=typeof i.getBoundary&&(r=new o({highWaterMark:t}),s=new o({highWaterMark:t}),i.pipe(r),i.pipe(s),e[j].stream=r,i=s),i},D=l((e=>e.getBoundary()),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),H=(e,t)=>null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":B(e)?"application/x-www-form-urlencoded;charset=UTF-8":k(e)?e.type||null:i.isBuffer(e)||a.isAnyArrayBuffer(e)||ArrayBuffer.isView(e)?null:e instanceof P?`multipart/form-data; boundary=${t[j].boundary}`:e&&"function"==typeof e.getBoundary?`multipart/form-data;boundary=${D(e)}`:e instanceof n?null:"text/plain;charset=UTF-8",I="function"==typeof e.validateHeaderName?e.validateHeaderName:e=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(e)){const t=new TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},W="function"==typeof e.validateHeaderValue?e.validateHeaderValue:(e,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){const t=new TypeError(`Invalid character in header content ["${e}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}};class _ extends URLSearchParams{constructor(e){let t=[];if(e instanceof _){const r=e.raw();for(const[e,n]of Object.entries(r))t.push(...n.map((t=>[e,t])))}else if(null==e);else{if("object"!=typeof e||a.isBoxedPrimitive(e))throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");{const r=e[Symbol.iterator];if(null==r)t.push(...Object.entries(e));else{if("function"!=typeof r)throw new TypeError("Header pairs must be iterable");t=[...e].map((e=>{if("object"!=typeof e||a.isBoxedPrimitive(e))throw new TypeError("Each header pair must be an iterable object");return[...e]})).map((e=>{if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");return[...e]}))}}}return t=t.length>0?t.map((([e,t])=>(I(e),W(e,String(t)),[String(e).toLowerCase(),String(t)]))):void 0,super(t),new Proxy(this,{get(e,t,r){switch(t){case"append":case"set":return(r,n)=>(I(r),W(r,String(n)),URLSearchParams.prototype[t].call(e,String(r).toLowerCase(),String(n)));case"delete":case"has":case"getAll":return r=>(I(r),URLSearchParams.prototype[t].call(e,String(r).toLowerCase()));case"keys":return()=>(e.sort(),new Set(URLSearchParams.prototype.keys.call(e)).keys());default:return Reflect.get(e,t,r)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const t=this.getAll(e);if(0===t.length)return null;let r=t.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t){for(const r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce(((e,t)=>(e[t]=this.getAll(t),e)),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce(((e,t)=>{const r=this.getAll(t);return e[t]="host"===t?r[0]:r.length>1?r:r[0],e}),{})}}Object.defineProperties(_.prototype,["get","entries","forEach","values"].reduce(((e,t)=>(e[t]={enumerable:!0},e)),{}));const N=new Set([301,302,303,307,308]),V=e=>N.has(e),G=Symbol("Response internals");class J extends O{constructor(e=null,t={}){super(e,t);const r=null!=t.status?t.status:200,n=new _(t.headers);if(null!==e&&!n.has("Content-Type")){const t=H(e,this);t&&n.append("Content-Type",t)}this[G]={type:"default",url:t.url,status:r,statusText:t.statusText||"",headers:n,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[G].type}get url(){return this[G].url||""}get status(){return this[G].status}get ok(){return this[G].status>=200&&this[G].status<300}get redirected(){return this[G].counter>0}get statusText(){return this[G].statusText}get headers(){return this[G].headers}get highWaterMark(){return this[G].highWaterMark}clone(){return new J(q(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!V(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new J(null,{headers:{location:new URL(e).toString()},status:t})}static error(){const e=new J(null,{status:0,statusText:""});return e[G].type="error",e}static json(e,t={}){const r=JSON.stringify(e);if(void 0===r)throw new TypeError("data is not JSON serializable");const n=new _(t&&t.headers);return n.has("content-type")||n.set("content-type","application/json"),new J(r,{...t,headers:n})}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(J.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});function K(e,t=!1){return null==e?"no-referrer":(e=new URL(e),/^(about|blob|data):$/.test(e.protocol)?"no-referrer":(e.username="",e.password="",e.hash="",t&&(e.pathname="",e.search=""),e))}const Y=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]);function Z(e){return!!/^about:(blank|srcdoc)$/.test(e)||("data:"===e.protocol||(!!/^(blob|filesystem):$/.test(e.protocol)||function(e){if(/^(http|ws)s:$/.test(e.protocol))return!0;const t=e.host.replace(/(^\[)|(]$)/g,""),r=f(t);return!(4!==r||!/^127\./.test(t))||!(6!==r||!/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t))||"localhost"!==e.host&&!e.host.endsWith(".localhost")&&"file:"===e.protocol}(e)))}const Q=Symbol("Request internals"),X=e=>"object"==typeof e&&"object"==typeof e[Q],ee=l((()=>{}),".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)");class te extends O{constructor(e,t={}){let r;if(X(e)?r=new URL(e.url):(r=new URL(e),e={}),""!==r.username||""!==r.password)throw new TypeError(`${r} is an url with embedded credentials.`);let n=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(n)&&(n=n.toUpperCase()),!X(t)&&"data"in t&&ee(),(null!=t.body||X(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");const o=t.body?t.body:X(e)&&null!==e.body?q(e):null;super(o,{size:t.size||e.size||0});const s=new _(t.headers||e.headers||{});if(null!==o&&!s.has("Content-Type")){const e=H(o,this);e&&s.set("Content-Type",e)}let i=X(e)?e.signal:null;if("signal"in t&&(i=t.signal),null!=i&&("object"!=typeof(a=i)||"AbortSignal"!==a[A]&&"EventTarget"!==a[A]))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");var a;let c=null==t.referrer?e.referrer:t.referrer;if(""===c)c="no-referrer";else if(c){const e=new URL(c);c=/^about:(\/\/)?client$/.test(e)?"client":e}else c=void 0;this[Q]={method:n,redirect:t.redirect||e.redirect||"follow",headers:s,parsedURL:r,signal:i,referrer:c},this.follow=void 0===t.follow?void 0===e.follow?20:e.follow:t.follow,this.compress=void 0===t.compress?void 0===e.compress||e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Q].method}get url(){return u(this[Q].parsedURL)}get headers(){return this[Q].headers}get redirect(){return this[Q].redirect}get signal(){return this[Q].signal}get referrer(){return"no-referrer"===this[Q].referrer?"":"client"===this[Q].referrer?"about:client":this[Q].referrer?this[Q].referrer.toString():void 0}get referrerPolicy(){return this[Q].referrerPolicy}set referrerPolicy(e){this[Q].referrerPolicy=function(e){if(!Y.has(e))throw new TypeError(`Invalid referrerPolicy: ${e}`);return e}(e)}clone(){return new te(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(te.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});const re=e=>{const{parsedURL:t}=e[Q],r=new _(e[Q].headers);r.has("Accept")||r.set("Accept","*/*");let n=null;if(null===e.body&&/^(post|put)$/i.test(e.method)&&(n="0"),null!==e.body){const t=(e=>{const{body:t}=e[j];return null===t?0:k(t)?t.size:i.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null})(e);"number"!=typeof t||Number.isNaN(t)||(n=String(t))}n&&r.set("Content-Length",n),""===e.referrerPolicy&&(e.referrerPolicy="strict-origin-when-cross-origin"),e.referrer&&"no-referrer"!==e.referrer?e[Q].referrer=function(e,{referrerURLCallback:t,referrerOriginCallback:r}={}){if("no-referrer"===e.referrer||""===e.referrerPolicy)return null;const n=e.referrerPolicy;if("about:client"===e.referrer)return"no-referrer";const o=e.referrer;let s=K(o),i=K(o,!0);s.toString().length>4096&&(s=i),t&&(s=t(s)),r&&(i=r(i));const a=new URL(e.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return i;case"unsafe-url":return s;case"strict-origin":return Z(s)&&!Z(a)?"no-referrer":i.toString();case"strict-origin-when-cross-origin":return s.origin===a.origin?s:Z(s)&&!Z(a)?"no-referrer":i;case"same-origin":return s.origin===a.origin?s:"no-referrer";case"origin-when-cross-origin":return s.origin===a.origin?s:i;case"no-referrer-when-downgrade":return Z(s)&&!Z(a)?"no-referrer":s;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}(e):e[Q].referrer="no-referrer",e[Q].referrer instanceof URL&&r.set("Referer",e.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=e;"function"==typeof o&&(o=o(t));const s=(e=>{if(e.search)return e.search;const t=e.href.length-1,r=e.hash||("#"===e.href[t]?"#":"");return"?"===e.href[t-r.length]?"?":""})(t);return{parsedURL:t,options:{path:t.pathname+s,method:e.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:e.insecureHTTPParser,agent:o}}};class ne extends U{constructor(e,t="aborted"){super(e,t)}}
/*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */if(!globalThis.DOMException)try{const{MessageChannel:e}=g,t=(new e).port1,r=new ArrayBuffer;t.postMessage(r,[r,r])}catch(e){"DOMException"===e.constructor.name&&(globalThis.DOMException=e.constructor)}var oe=globalThis.DOMException;const{stat:se}=p,ie=(e,t)=>ue(d(e),e,t),ae=(e,t)=>se(e).then((r=>ue(r,e,t))),ce=(e,t)=>se(e).then((r=>fe(r,e,t))),le=(e,t)=>fe(d(e),e,t),ue=(e,t,r="")=>new w([new de({path:t,size:e.size,lastModified:e.mtimeMs,start:0})],{type:r}),fe=(e,t,r="")=>new T([new de({path:t,size:e.size,lastModified:e.mtimeMs,start:0})],y(t),{type:r,lastModified:e.mtimeMs});class de{#a;#c;constructor(e){this.#a=e.path,this.#c=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new de({path:this.#a,lastModified:this.lastModified,size:t-e,start:this.#c+e})}async*stream(){const{mtimeMs:e}=await se(this.#a);if(e>this.lastModified)throw new oe("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*h(this.#a,{start:this.#c,end:this.#c+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}const he=new Set(["data:","http:","https:"]);async function pe(a,c){return new Promise(((l,u)=>{const f=new te(a,c),{parsedURL:d,options:h}=re(f);if(!he.has(d.protocol))throw new TypeError(`node-fetch cannot load ${a}. URL scheme "${d.protocol.replace(/:$/,"")}" is not supported.`);if("data:"===d.protocol){const e=function(e){if(!/^data:/i.test(e))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');const t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw new TypeError("malformed data: URI");const r=e.substring(5,t).split(";");let n="",o=!1;const s=r[0]||"text/plain";let i=s;for(let e=1;e<r.length;e++)"base64"===r[e]?o=!0:r[e]&&(i+=`;${r[e]}`,0===r[e].indexOf("charset=")&&(n=r[e].substring(8)));r[0]||n.length||(i+=";charset=US-ASCII",n="US-ASCII");const a=o?"base64":"ascii",c=unescape(e.substring(t+1)),l=Buffer.from(c,a);return l.type=s,l.typeFull=i,l.charset=n,l}(f.url),t=new J(e,{headers:{"Content-Type":e.typeFull}});return void l(t)}const p=("https:"===d.protocol?t:e).request,{signal:y}=f;let g=null;const m=()=>{const e=new ne("The operation was aborted.");u(e),f.body&&f.body instanceof n.Readable&&f.body.destroy(e),g&&g.body&&g.body.emit("error",e)};if(y&&y.aborted)return void m();const b=()=>{m(),T()},w=p(d.toString(),h);y&&y.addEventListener("abort",b);const T=()=>{w.abort(),y&&y.removeEventListener("abort",b)};w.on("error",(e=>{u(new z(`request to ${f.url} failed, reason: ${e.message}`,"system",e)),T()})),function(e,t){const r=i.from("0\r\n\r\n");let n,o=!1,s=!1;e.on("response",(e=>{const{headers:t}=e;o="chunked"===t["transfer-encoding"]&&!t["content-length"]})),e.on("socket",(a=>{const c=()=>{if(o&&!s){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",t(e)}},l=e=>{s=0===i.compare(e.slice(-5),r),!s&&n&&(s=0===i.compare(n.slice(-3),r.slice(0,3))&&0===i.compare(e.slice(-2),r.slice(3))),n=e};a.prependListener("close",c),a.on("data",l),e.on("close",(()=>{a.removeListener("close",c),a.removeListener("data",l)}))}))}(w,(e=>{g&&g.body&&g.body.destroy(e)})),process.version<"v14"&&w.on("socket",(e=>{let t;e.prependListener("end",(()=>{t=e._eventsCount})),e.prependListener("close",(r=>{if(g&&t<e._eventsCount&&!r){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",g.body.emit("error",e)}}))})),w.on("response",(e=>{w.setTimeout(0);const t=function(e=[]){return new _(e.reduce(((e,t,r,n)=>(r%2==0&&e.push(n.slice(r,r+2)),e)),[]).filter((([e,t])=>{try{return I(e),W(e,String(t)),!0}catch{return!1}})))}(e.rawHeaders);if(V(e.statusCode)){const r=t.get("Location");let o=null;try{o=null===r?null:new URL(r,f.url)}catch{if("manual"!==f.redirect)return u(new z(`uri requested responds with an invalid redirect URL: ${r}`,"invalid-redirect")),void T()}switch(f.redirect){case"error":return u(new z(`uri requested responds with a redirect, redirect mode is set to error: ${f.url}`,"no-redirect")),void T();case"manual":break;case"follow":{if(null===o)break;if(f.counter>=f.follow)return u(new z(`maximum redirect reached at: ${f.url}`,"max-redirect")),void T();const r={headers:new _(f.headers),follow:f.follow,counter:f.counter+1,agent:f.agent,compress:f.compress,method:f.method,body:q(f),signal:f.signal,size:f.size,referrer:f.referrer,referrerPolicy:f.referrerPolicy};if(!((e,t)=>{const r=new URL(t).hostname,n=new URL(e).hostname;return r===n||r.endsWith(`.${n}`)})(f.url,o)||(i=f.url,new URL(o).protocol!==new URL(i).protocol))for(const e of["authorization","www-authenticate","cookie","cookie2"])r.headers.delete(e);if(303!==e.statusCode&&f.body&&c.body instanceof n.Readable)return u(new z("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void T();303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==f.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length"));const s=function(e){const t=(e.get("referrer-policy")||"").split(/[,\s]+/);let r="";for(const e of t)e&&Y.has(e)&&(r=e);return r}(t);return s&&(r.referrerPolicy=s),l(pe(new te(o,r))),void T()}default:return u(new TypeError(`Redirect option '${f.redirect}' is not a valid value of RequestRedirect`))}}var i;y&&e.once("end",(()=>{y.removeEventListener("abort",b)}));let a=s(e,new o,(e=>{e&&u(e)}));process.version<"v12.10"&&e.on("aborted",b);const d={url:f.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:f.size,counter:f.counter,highWaterMark:f.highWaterMark},h=t.get("Content-Encoding");if(!f.compress||"HEAD"===f.method||null===h||204===e.statusCode||304===e.statusCode)return g=new J(a,d),void l(g);const p={flush:r.Z_SYNC_FLUSH,finishFlush:r.Z_SYNC_FLUSH};if("gzip"===h||"x-gzip"===h)return a=s(a,r.createGunzip(p),(e=>{e&&u(e)})),g=new J(a,d),void l(g);if("deflate"===h||"x-deflate"===h){const t=s(e,new o,(e=>{e&&u(e)}));return t.once("data",(e=>{a=8==(15&e[0])?s(a,r.createInflate(),(e=>{e&&u(e)})):s(a,r.createInflateRaw(),(e=>{e&&u(e)})),g=new J(a,d),l(g)})),void t.once("end",(()=>{g||(g=new J(a,d),l(g))}))}if("br"===h)return a=s(a,r.createBrotliDecompress(),(e=>{e&&u(e)})),g=new J(a,d),void l(g);g=new J(a,d),l(g)})),(async(e,{body:t})=>{null===t?e.end():await C(t,e)})(w,f).catch(u)}))}export default pe;export{ne as AbortError,w as Blob,z as FetchError,T as File,P as FormData,_ as Headers,te as Request,J as Response,ae as blobFrom,ie as blobFromSync,ce as fileFrom,le as fileFromSync,V as isRedirect};
//# sourceMappingURL=index-f7d3502a.js.map
